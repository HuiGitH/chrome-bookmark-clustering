(lp0
S'http://dongweiming.github.io/blog/archives/feng-zhuang-pymongozi-dong-guan-bi-lian-jie/'
p1
aS'\xe5\xb0\x81\xe8\xa3\x85pymongo\xe8\x87\xaa\xe5\x8a\xa8\xe5\x85\xb3\xe9\x97\xad\xe8\xbf\x9e\xe6\x8e\xa5 - \xe5\xb0\x8f\xe6\x98\x8e\xe6\x98\x8es \xc3\xa0 domicile'
p2
aI0
aV<!DOCTYPE html>\u000a<html>\u000a<head>\u000a  <meta charset="utf-8">\u000a  \u000a  <meta name="google-site-verification" content="l0ubmRH05-uRV2Du3pV7d42dlYTq3snmH_DjrfBhukk">\u000a  \u000a  \u000a  \u000a  <title>\u5c01\u88c5pymongo\u81ea\u52a8\u5173\u95ed\u8fde\u63a5 | \u5c0f\u660e\u660es à domicile | Python\u4e4b\u7f8e</title>\u000a  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">\u000a  \u000a  <meta name="theme-color" content="#00BCD4">\u000a  \u000a  \u000a  <meta name="keywords" content="pymongo">\u000a  <meta name="description" content="####\u524d\u8a00\u000a\u5728\u6211\u5de5\u4f5c\u7684\u9879\u76ee\u91cc\u9762\u4f7f\u7528\u4e86mongodb.\u81ea\u7136\u4e5f\u7528\u5230\u4e86pymongo.\u4f46\u662f\u5b83\u90fd\u662f\u5728\u5927\u7247\u7684\u51fd\u6570\u91cc\u9762\u4f7f\u7528\u7c7b\u4f3c\u4e8e\u8fd9\u6837\u7684\u65b9\u5f0f\u000a12345import dbdef test():    ...    db.test.find_one()    ...\u000a\u4f46\u662f\u95ee\u9898\u662f\u5728\u4f7f\u7528\u5b8c\u90fd\u6ca1\u6709\u5173\u95ed\u8fde\u63a5,\u8fd9\u6837\u591a\u53f0\u670d\u52a1\u5668\u8fde\u63a5\u6211\u8fd9\u53f0mongodb\u670d\u52a1\u5668\uff0c\u5728\u4e1a\u52a1\u9ad8\u5cf0\u671f\u5c31\u4f1a\u5360\u6ee1\u6211\u7684\u8fde\u63a5, \u6211\u5f53\u65f6\u603b\u7ed3\u9020\u6210\u8fd9\u4e2a\u539f\u56e0\u7684\u95ee\u9898\u6709\u4ee5\u4e0b">\u000a<meta property="og:type" content="article">\u000a<meta property="og:title" content="\u5c01\u88c5pymongo\u81ea\u52a8\u5173\u95ed\u8fde\u63a5">\u000a<meta property="og:url" content="http://www.dongwm.com/archives/feng-zhuang-pymongozi-dong-guan-bi-lian-jie/index.html">\u000a<meta property="og:site_name" content="\u5c0f\u660e\u660es à domicile">\u000a<meta property="og:description" content="####\u524d\u8a00\u000a\u5728\u6211\u5de5\u4f5c\u7684\u9879\u76ee\u91cc\u9762\u4f7f\u7528\u4e86mongodb.\u81ea\u7136\u4e5f\u7528\u5230\u4e86pymongo.\u4f46\u662f\u5b83\u90fd\u662f\u5728\u5927\u7247\u7684\u51fd\u6570\u91cc\u9762\u4f7f\u7528\u7c7b\u4f3c\u4e8e\u8fd9\u6837\u7684\u65b9\u5f0f\u000a12345import dbdef test():    ...    db.test.find_one()    ...\u000a\u4f46\u662f\u95ee\u9898\u662f\u5728\u4f7f\u7528\u5b8c\u90fd\u6ca1\u6709\u5173\u95ed\u8fde\u63a5,\u8fd9\u6837\u591a\u53f0\u670d\u52a1\u5668\u8fde\u63a5\u6211\u8fd9\u53f0mongodb\u670d\u52a1\u5668\uff0c\u5728\u4e1a\u52a1\u9ad8\u5cf0\u671f\u5c31\u4f1a\u5360\u6ee1\u6211\u7684\u8fde\u63a5, \u6211\u5f53\u65f6\u603b\u7ed3\u9020\u6210\u8fd9\u4e2a\u539f\u56e0\u7684\u95ee\u9898\u6709\u4ee5\u4e0b">\u000a<meta property="og:updated_time" content="2016-11-13T07:52:45.000Z">\u000a<meta name="twitter:card" content="summary">\u000a<meta name="twitter:title" content="\u5c01\u88c5pymongo\u81ea\u52a8\u5173\u95ed\u8fde\u63a5">\u000a<meta name="twitter:description" content="####\u524d\u8a00\u000a\u5728\u6211\u5de5\u4f5c\u7684\u9879\u76ee\u91cc\u9762\u4f7f\u7528\u4e86mongodb.\u81ea\u7136\u4e5f\u7528\u5230\u4e86pymongo.\u4f46\u662f\u5b83\u90fd\u662f\u5728\u5927\u7247\u7684\u51fd\u6570\u91cc\u9762\u4f7f\u7528\u7c7b\u4f3c\u4e8e\u8fd9\u6837\u7684\u65b9\u5f0f\u000a12345import dbdef test():    ...    db.test.find_one()    ...\u000a\u4f46\u662f\u95ee\u9898\u662f\u5728\u4f7f\u7528\u5b8c\u90fd\u6ca1\u6709\u5173\u95ed\u8fde\u63a5,\u8fd9\u6837\u591a\u53f0\u670d\u52a1\u5668\u8fde\u63a5\u6211\u8fd9\u53f0mongodb\u670d\u52a1\u5668\uff0c\u5728\u4e1a\u52a1\u9ad8\u5cf0\u671f\u5c31\u4f1a\u5360\u6ee1\u6211\u7684\u8fde\u63a5, \u6211\u5f53\u65f6\u603b\u7ed3\u9020\u6210\u8fd9\u4e2a\u539f\u56e0\u7684\u95ee\u9898\u6709\u4ee5\u4e0b">\u000a  \u000a    <link rel="alternative" href="/atom.xml" title="\u5c0f\u660e\u660es à domicile" type="application/atom+xml">\u000a  \u000a  <meta name="summary" content="\u4e00\u4e2aPython\u624b\u827a\u4eba">\u000a  <link rel="shortcut icon" href="/favicon.ico">\u000a  <link rel="stylesheet" href="/css/style.css?v=1.1.10">\u000a</head>\u000a\u000a<body>\u000a  <div id="loading" class="active"></div>\u000a\u000a  <aside id="menu" class="hide" >\u000a  <div class="inner flex-row-vertical">\u000a    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">\u000a        <i class="icon icon-lg icon-close"></i>\u000a    </a>\u000a    <div class="brand-wrap">\u000a      <div class="brand">\u000a        <a href="/" class="avatar waves-effect waves-circle waves-light"><img src="/img/avatar.png"></a>\u000a        <hgroup class="introduce">\u000a          <h5 class="nickname">Dongweiming</h5>\u000a          <a href="mailto:ciici123@gmail.com" title="ciici123@gmail.com" class="mail">ciici123@gmail.com</a>\u000a        </hgroup>\u000a      </div>\u000a    </div>\u000a    <div class="scroll-wrap flex-col">\u000a      <ul class="nav">\u000a        \u000a            <li class="waves-block waves-effect">\u000a              <a href="/"  >\u000a                <i class="icon icon-lg icon-home"></i>\u000a                \u4e3b\u9875\u000a              </a>\u000a            </li>\u000a        \u000a            <li class="waves-block waves-effect active">\u000a              <a href="/archives"  >\u000a                <i class="icon icon-lg icon-archives"></i>\u000a                Archives\u000a              </a>\u000a            </li>\u000a        \u000a            <li class="waves-block waves-effect">\u000a              <a href="/tags"  >\u000a                <i class="icon icon-lg icon-tags"></i>\u000a                Tags\u000a              </a>\u000a            </li>\u000a        \u000a            <li class="waves-block waves-effect">\u000a              <a href="/categories"  >\u000a                <i class="icon icon-lg icon-th-list"></i>\u000a                Categories\u000a              </a>\u000a            </li>\u000a        \u000a            <li class="waves-block waves-effect">\u000a              <a href="/old"  >\u000a                <i class="icon icon-lg icon-list-alt"></i>\u000a                \u65e7\u535a\u5ba2\u000a              </a>\u000a            </li>\u000a        \u000a            <li class="waves-block waves-effect">\u000a              <a href="//github.com/dongweiming" target="_blank" >\u000a                <i class="icon icon-lg icon-github"></i>\u000a                Github\u000a              </a>\u000a            </li>\u000a        \u000a      </ul>\u000a\u000a      <footer class="footer">\u000a  <p><a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0;vertical-align:middle;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAAllBMVEUAAAD///+rsapERER3d3eIiIjMzMzu7u4iIiKUmZO6v7rKzsoODg4RERFVVVUNDQ0NDg0PEA8zMzNLTEtbXltmZmZydnF9gn2AgICPkI+ZmZmqqqq7u7vFxsXIzMgNDQwZGRkgICAhISEkJSMnKCcuMC4xMzE5Ozk7PTtBQkFCQkJDQ0Nna2eGhoaHh4ezuLLGysbd3d1wVGpAAAAA4UlEQVR42q2T1xqCMAyFk7QsBQeKA9x7j/d/OSm22CpX0nzcpA1/T05aAOuBVkMAScQFHLnEwoCo2f1TnQIGoVMewjZEjVFN4GH1Ue1Cn2jWqwfsOOj6wDwGvotsl/c8lv7KIq1eLOsT0HMFHMIE/RZyHnlphryT9zyV+8WH5e8yQw3wnQvgAFxPTKUVi555SHR/lOfLMgVTeDlSfN+TaoUsiTyeIm+bCkHvCA2FUKG48LDtYBZBknsYP/G8NTw0gaaHyuQf4H5pecrB/FYCT2sL9zAfy1Xyjou6L8X2W7YcLyBZCRtnq/zfAAAAAElFTkSuQmCC" /></a></p>\u000a  <p>\u5c0f\u660e\u660es à domicile &copy; 2011 - 2016</p>\u000a  <p>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme\u000a  <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></p>\u000a  <a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-2x icon-rss-square"></i></a>\u000a</footer>\u000a\u000a    </div>\u000a  </div>\u000a</aside>\u000a  <main id="main">\u000a    <header class="top-header" id="header">\u000a    <div class="flex-row">\u000a        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">\u000a          <i class="icon icon-lg icon-navicon"></i>\u000a        </a>\u000a        <div class="flex-col header-title ellipsis">\u5c01\u88c5pymongo\u81ea\u52a8\u5173\u95ed\u8fde\u63a5</div>\u000a        \u000a        <div class="search-wrap" id="search-wrap">\u000a            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">\u000a                <i class="icon icon-lg icon-chevron-left"></i>\u000a            </a>\u000a            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="\u8f93\u5165\u611f\u5174\u8da3\u7684\u5173\u952e\u5b57">\u000a            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">\u000a                <i class="icon icon-lg icon-search"></i>\u000a            </a>\u000a        </div>\u000a        \u000a        \u000a        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-share">\u000a            <i class="icon icon-lg icon-share-alt"></i>\u000a        </a>\u000a        \u000a    </div>\u000a</header>\u000a\u000a<header class="content-header post-header">\u000a\u000a    <div class="container">\u000a        <h1 class="title">\u5c01\u88c5pymongo\u81ea\u52a8\u5173\u95ed\u8fde\u63a5</h1>\u000a        <h5 class="subtitle">\u000a            \u000a                <time datetime="2013-08-16T13:42:00.000Z" itemprop="datePublished" class="page-time">\u000a  2013-08-16\u000a</time>\u000a\u000a\u000a	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/pymongo/">pymongo</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/pymongo/mongodb/">mongodb</a></li></ul></li></ul>\u000a\u000a\u000a            \u000a        </h5>\u000a    </div>\u000a\u000a    \u000a\u000a</header>\u000a\u000a\u000a<div class="container body-wrap">\u000a    \u000a     \u000a\u000a     <aside class="post-widget">\u000a         <nav class="post-toc-wrap" id="post-toc">\u000a             <h4>\u626b\u7801\u5173\u6ce8\u300cPython\u4e4b\u7f8e\u300d</h4>\u000a             <h5>\u83b7\u5f97\u535a\u5ba2\u6700\u65b0\u5185\u5bb9</h5>\u000a             <img class="post-weixin" src="/img/weixin.jpg" alt="\u626b\u7801\u5173\u6ce8\u672c\u535a\u5ba2\u7684\u5fae\u4fe1\u516c\u4f17\u53f7">\u000a             \u000a         </nav>\u000a    </aside>\u000a\u000a\u000a<article id="post-feng-zhuang-pymongozi-dong-guan-bi-lian-jie" \u000a  class="post-article article-type-post" itemprop="blogPost">\u000a\u000a    <div class="post-card">\u000a        <h1 class="post-card-title">\u5c01\u88c5pymongo\u81ea\u52a8\u5173\u95ed\u8fde\u63a5</h1>\u000a        <div class="post-meta">\u000a            <time datetime="2013-08-16T13:42:00.000Z" itemprop="datePublished" class="post-time">\u000a  2013-08-16\u000a</time>\u000a\u000a            \u000a	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/pymongo/">pymongo</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/pymongo/mongodb/">mongodb</a></li></ul></li></ul>\u000a\u000a\u000a\u000a        </div>\u000a        <div class="post-content" id="post-content" itemprop="postContent">\u000a            <p>####\u524d\u8a00</p>\u000a<p>\u5728\u6211\u5de5\u4f5c\u7684\u9879\u76ee\u91cc\u9762\u4f7f\u7528\u4e86mongodb.\u81ea\u7136\u4e5f\u7528\u5230\u4e86pymongo.\u4f46\u662f\u5b83\u90fd\u662f\u5728\u5927\u7247\u7684\u51fd\u6570\u91cc\u9762\u4f7f\u7528\u7c7b\u4f3c\u4e8e\u8fd9\u6837\u7684\u65b9\u5f0f</p>\u000a<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> db</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></div><div class="line">    ...</div><div class="line">    db.test.find_one()</div><div class="line">    ...</div></pre></td></tr></table></figure>\u000a<p>\u4f46\u662f\u95ee\u9898\u662f\u5728\u4f7f\u7528\u5b8c\u90fd\u6ca1\u6709\u5173\u95ed\u8fde\u63a5,\u8fd9\u6837\u591a\u53f0\u670d\u52a1\u5668\u8fde\u63a5\u6211\u8fd9\u53f0mongodb\u670d\u52a1\u5668\uff0c\u5728\u4e1a\u52a1\u9ad8\u5cf0\u671f\u5c31\u4f1a\u5360\u6ee1\u6211\u7684\u8fde\u63a5, \u6211\u5f53\u65f6\u603b\u7ed3\u9020\u6210\u8fd9\u4e2a\u539f\u56e0\u7684\u95ee\u9898\u6709\u4ee5\u4e0b\u4e09\u79cd:</p>\u000a<ol>\u000a<li><p>\u4e0a\u9762\u8bf4\u7684\u7528\u5b8cdb\u4e0d\u5173\u95ed\u8fde\u63a5\u800c\u662f\u7b49\u7740db\u8d85\u65f6</p>\u000a</li>\u000a<li><p>\u6ce8\u610f\u4e0a\u9762\u7684import\uff0c\u5176\u5b9e\u5728import\u6587\u4ef6\u7684\u65f6\u5019\u6570\u636e\u5e93\u8fde\u63a5\u5c31\u5df2\u7ecf\u751f\u6210\u4e86\uff0c\u6ca1\u6709\u5728\u9700\u8981\u7684\u65f6\u5019\u624d\u521b\u5efa, \u5360\u6ee1\u6211\u8fde\u63a5\u7684\u5e94\u7528\u5176\u5b9e\u6709\u5f88\u591a\u6ca1\u6709\u7528\uff0c\u6d6a\u8d39\u4e86</p>\u000a</li>\u000a<li><p>nginx\u3001uwsgi\uff0ccelery\u7b49\u5e94\u7528\u914d\u7f6e\u7684\u95ee\u9898\uff0c\u9020\u6210\u8fc7\u591a\u7684\u5b9e\u4f8b\uff0c\u5176\u5b9e\u6839\u672c\u65e0\u76ca</p>\u000a</li>\u000a</ol>\u000a<p>####\u6211\u4eca\u5929\u5199\u7684\u4e00\u4e2a\u5c01\u88c5pymongo\u548c\u5173\u95ed\u6570\u636e\u5e93\u8fde\u63a5\u7684\u88c5\u9970\u5668</p>\u000a<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#/usr/bin/env python</span></div><div class="line"><span class="comment"># coding=utf-8</span></div><div class="line"></div><div class="line"><span class="string">"""</span></div><div class="line">1. \u5c01\u88c5\u6570\u636e\u5e93\u64cd\u4f5c(INSERT,FIND,UPDATE)</div><div class="line">2. \u51fd\u6570\u6267\u884c\u5b8cMONGODB\u64cd\u4f5c\u540e\u5173\u95ed\u6570\u636e\u5e93\u8fde\u63a5</div><div class="line">"""</div><div class="line"></div><div class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</div><div class="line"><span class="keyword">from</span> pymongo.database <span class="keyword">import</span> Database</div><div class="line"></div><div class="line"><span class="keyword">try</span>:</div><div class="line">    <span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</div><div class="line"><span class="keyword">except</span> ImportError:</div><div class="line">    <span class="comment"># \u597d\u50cf2.4\u4e4b\u524d\u7684pymongo\u90fd\u6ca1\u6709MongoClient,\u73b0\u5728\u5b98\u7f51\u5df2\u7ecf\u628aConnection\u629b\u5f03\u4e86</span></div><div class="line">    <span class="keyword">import</span> warnings</div><div class="line">    warnings.warn(<span class="string">"Strongly recommend upgrading to the latest version pymongo version,"</span></div><div class="line">                  <span class="string">"Connection is DEPRECATED: Please use mongo_client instead."</span>)</div><div class="line">    <span class="keyword">from</span> pymongo <span class="keyword">import</span> Connection <span class="keyword">as</span> MongoClient</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mongo</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="string">'''\u5c01\u88c5\u6570\u636e\u5e93\u64cd\u4f5c'''</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>, database=<span class="string">'test'</span>,</span></span></div><div class="line">                 max_pool_size=<span class="number">10</span>, timeout=<span class="number">10</span>):</div><div class="line">        self.host = host</div><div class="line">        self.port = port</div><div class="line">        self.max_pool_size = max_pool_size</div><div class="line">        self.timeout = timeout</div><div class="line">        self.database = database</div><div class="line"></div><div class="line"><span class="meta">    @property</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connect</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="comment"># \u6211\u8fd9\u91cc\u662f\u4e3a\u4e86\u4f7f\u7528\u7c7b\u4f3c"db.\u96c6\u5408.\u64cd\u4f5c"\u7684\u64cd\u4f5c\u7684\u65f6\u5019\u624d\u4f1a\u751f\u6210\u6570\u636e\u5e93\u8fde\u63a5,\u5176\u5b9epymongo\u5df2\u7ecf\u5b9e\u73b0\u4e86\u8fdb\u7a0b\u6c60,\u4e5f\u53ef\u4ee5\u628a\u8fd9\u4e2adb\u653e\u5728__init__\u91cc\u9762,</span></div><div class="line">        <span class="comment"># \u6bd4\u5982\u6211\u628adb\u5173\u6389\u6709\u5176\u4ed6\u7684\u6570\u636e\u5e93\u8c03\u7528\u8fde\u63a5\u53c8\u4f1a\u751f\u6210,\u5e76\u4e14\u4e0d\u5f71\u54cd\u4f7f\u7528.\u6211\u8fd9\u91cc\u53ea\u662f\u60f3\u6bcf\u6b21\u6267\u884c\u6570\u636e\u5e93\u751f\u6210\u4e00\u4e2a\u8fde\u63a5\u7528\u5b8c\u5173\u6389-\u81ea\u5df1\u63a7\u5236\u81ea\u5df1\u7684</span></div><div class="line">        <span class="keyword">return</span> MongoClientself.host, self.port, max_pool_size=self.max_pool_size,</div><div class="line">                  connectTimeoutMS=<span class="number">60</span> * <span class="number">60</span> * self.timeout)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, collection)</span>:</span></div><div class="line">        <span class="comment"># \u4e3a\u4e86\u517c\u5bb9db[\u96c6\u5408].\u64cd\u4f5c\u7684\u7528\u6cd5</span></div><div class="line">        <span class="keyword">return</span> self.__getattr__(collection)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, collection_or_func)</span>:</span></div><div class="line">        db = self.connect[self.database]</div><div class="line">        <span class="keyword">if</span> collection_or_func <span class="keyword">in</span> Database.__dict__:</div><div class="line">            <span class="comment"># \u5f53\u8c03\u7528\u7684\u662fdb\u7684\u65b9\u6cd5\u5c31\u76f4\u63a5\u8fd4\u56de</span></div><div class="line">            <span class="keyword">return</span> getattr(db, collection_or_func)</div><div class="line">        <span class="comment"># \u5426\u5219\u59d4\u6d3e\u7ed9Collection</span></div><div class="line">        <span class="keyword">return</span> Collection(db, collection_or_func)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Collection</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, db, collection)</span>:</span></div><div class="line">        self.collection = getattr(db, collection)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, operation)</span>:</span></div><div class="line">        <span class="comment"># \u6211\u8fd9\u4e2a\u5c01\u88c5\u53ea\u662f\u4e3a\u4e86\u62e6\u622a\u4e00\u90e8\u5206\u64cd\u4f5c,\u4e0d\u7b26\u5408\u7684\u5c31\u76f4\u63a5raise\u5c5e\u6027\u9519\u8bef</span></div><div class="line">        control_type = [<span class="string">'disconnect'</span>, <span class="string">'insert'</span>, <span class="string">'update'</span>, <span class="string">'find'</span>, <span class="string">'find_one'</span>]</div><div class="line">        <span class="keyword">if</span> operation <span class="keyword">in</span> control_type:</div><div class="line">            <span class="keyword">return</span> getattr(self.collection, operation)</div><div class="line">        <span class="keyword">raise</span> AttributeError(operation)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">close_db</span><span class="params">(dbs=[<span class="string">'db'</span>])</span>:</span></div><div class="line">    <span class="string">'''</span></div><div class="line">    \u5173\u95edmongodb\u6570\u636e\u5e93\u8fde\u63a5</div><div class="line">    db : \u5728\u6267\u884c\u51fd\u6570\u91cc\u9762\u4f7f\u7528\u7684db\u7684\u540d\u5b57(\u5927\u90e8\u5206\u662fdb\uff0c\u4e5f\u4f1a\u6709s_db)</div><div class="line">        Usage::</div><div class="line">            &gt;&gt;&gt;s_db = Mongo()</div><div class="line">            &gt;&gt;&gt;@close_db(['s_db'])</div><div class="line">            ...: def test():</div><div class="line">            ...:     print s_db.test.insert(&#123;'a': 1, 'b': 2&#125;)</div><div class="line">            ...:</div><div class="line">    '''</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_deco</span><span class="params">(func)</span>:</span></div><div class="line"><span class="meta">        @wraps(func)</span></div><div class="line">        <span class="function"><span class="keyword">def</span> <span class="title">_call</span><span class="params">(*args, **kwargs)</span>:</span></div><div class="line">            result = func(*args, **kwargs)</div><div class="line">            <span class="keyword">for</span> db <span class="keyword">in</span> dbs:</div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    func.func_globals[db].connection.disconnect()</div><div class="line">                <span class="keyword">except</span> KeyError:</div><div class="line">                    <span class="keyword">pass</span></div><div class="line">            <span class="keyword">return</span> result</div><div class="line">        <span class="keyword">return</span> _call</div><div class="line">    <span class="keyword">return</span> _deco</div></pre></td></tr></table></figure>\u000a<p>PS: \u5728\u6211\u6d4b\u8bd5\u7684\u65f6\u5019\u53d1\u73b0,\u4f7f\u7528Mongo()\u7c7b\u751f\u6210\u7684db\uff0c\u64cd\u4f5c\u5b8c\u4f1a\u81ea\u52a8\u5173\u95ed\u8fde\u63a5\u4e86\u2026</p>\u000a<p>####\u600e\u4e48\u6837\u7ed9\u4e00\u4e2a\u5f88\u5927\u7684\u6587\u4ef6\u6bcf\u4e2a\u51fd\u6570\u90fd\u52a0\u4e0a\u9762\u7684\u8fd9\u4e2a\u88c5\u9970\u5668\uff1f</p>\u000a<p>\u9879\u76ee\u6bcf\u4e2a\u811a\u672c\u7684\u4ee3\u7801\u90fd\u5f88\u957f\uff0c\u51fd\u6570\u4e5f\u5f88\u591a\uff0c\u5e76\u4e14\u6bcf\u4e2a\u51fd\u6570\u91cc\u9762\u4f7f\u7528\u7684db\u7684\u540d\u5b57\u90fd\u4e0d\u540c,\u6bd4\u5982\u6709\u4e00\u4e9b\u4e00\u4e9b\u98ce\u683c:</p>\u000a<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">db.test.find_one()</div><div class="line">s_db.test.insert(dict(test=<span class="string">'test'</span>))</div><div class="line">...</div></pre></td></tr></table></figure>\u000a<p>\u6bcf\u4e2a\u51fd\u6570\u52a0\u4e00\u4e2a\u88c5\u9970\u5668,\u597d\u8d39\u52b2\uff0c\u5c31\u60f3\u80fd\u4e0d\u80fd\u81ea\u52a8\u5206\u8fa8\u6587\u4ef6\u4e2d\u7684\u51fd\u6570\u7136\u540e\u7ed9\u4ed6\u4eec\u81ea\u52a8\u52a0\u88c5\u9970\u5668\uff0c\u7136\u540e\u5c31\u6709\u4ee5\u4e0b\u7684\u4e00\u4e2a\u505a\u597d\u7684\u811a\u672c:</p>\u000a<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#coding=utf-8</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</div><div class="line"><span class="keyword">import</span> copy</div><div class="line"><span class="keyword">import</span> types</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(func)</span>:</span></div><div class="line"><span class="meta">    @wraps(func)</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_call</span><span class="params">(*args, **kwargs)</span>:</span></div><div class="line">        result = func(*args, **kwargs)</div><div class="line">        <span class="keyword">print</span> <span class="string">'wrap you'</span></div><div class="line">        <span class="keyword">return</span> result</div><div class="line">    <span class="keyword">return</span> _call</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'test'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test2</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'test3'</span></div><div class="line"></div><div class="line">glocal_dict = copy.copy(globals())</div><div class="line"></div><div class="line">func_list = [[k, v] <span class="keyword">for</span> k, v <span class="keyword">in</span> glocal_dict.iteritems() <span class="keyword">if</span> <span class="keyword">not</span> k.startswith(<span class="string">'__'</span>)]</div><div class="line"></div><div class="line"><span class="keyword">for</span> func_name, func <span class="keyword">in</span> func_list:</div><div class="line">    <span class="keyword">if</span>  func_name <span class="keyword">in</span> [<span class="string">'wraps'</span>, <span class="string">'copy'</span>, <span class="string">'wrap'</span>, <span class="string">'types'</span>]:</div><div class="line">        <span class="keyword">continue</span></div><div class="line">    <span class="keyword">if</span> types.FunctionType  == type(func):</div><div class="line">        globals()[func_name]= wrap(func)</div></pre></td></tr></table></figure>\u000a<p>\u8fd9\u6837\u5f53\u4f60\u8c03\u7528\u7684\u65f6\u5019\u81ea\u52a8\u5c31\u6709\u4e86\u88c5\u9970\u5668:</p>\u000a<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from <span class="built_in">test</span> import <span class="built_in">test</span></div><div class="line">&gt;&gt;&gt; <span class="built_in">test</span>()</div><div class="line"><span class="built_in">test</span></div><div class="line">wrap you</div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure>\u000a\u000a        </div>\u000a\u000a        <blockquote class="post-copyright">\u000a    <div class="content">\u000a        \u7248\u6743\u58f0\u660e\uff1a<a href="/archives/feng-zhuang-pymongozi-dong-guan-bi-lian-jie/" target="_blank" rel="external">http://www.dongwm.com/archives/feng-zhuang-pymongozi-dong-guan-bi-lian-jie/</a>\u000a    </div>\u000a    <footer>\u000a        <a href="http://www.dongwm.com">\u000a            <img src="/img/avatar.png" alt="Dongweiming">\u000a            Dongweiming\u000a        </a>\u000a    </footer>\u000a</blockquote>\u000a        \u000a\u000a        <div class="post-footer">\u000a            \u000a	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pymongo/">pymongo</a></li></ul>\u000a\u000a\u000a            \u000a<div class="post-share-wrap">\u000a    <div class="post-share" id="post-share">\u000a    <div class="tit">\u5206\u4eab\u5230\uff1a</div>\u000a    <ul class="reset share-icons">\u000a      <li>\u000a        <a class="weibo share-sns" href="javascript:;" data-title="\u5fae\u535a" data-service="tsina">\u000a          <i class="icon icon-weibo"></i>\u000a        </a>\u000a      </li>\u000a      <li>\u000a        <a class="weixin share-sns" href="javascript:;" data-title="\u5fae\u4fe1" data-service="weixin">\u000a          <i class="icon icon-weixin"></i>\u000a        </a>\u000a      </li>\u000a      <li>\u000a        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">\u000a          <i class="icon icon-qq"></i>\u000a        </a>\u000a      </li>\u000a      <li>\u000a        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">\u000a          <i class="icon icon-facebook"></i>\u000a        </a>\u000a      </li>\u000a      <li>\u000a        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">\u000a          <i class="icon icon-twitter"></i>\u000a        </a>\u000a      </li>\u000a      <li>\u000a        <a class="douban share-sns" href="javascript:;" data-title="\u8c46\u74e3" data-service="douban">\u000a          \u8c46\u000a        </a>\u000a      </li>\u000a    </ul>\u000a </div>\u000a\u000a    <a href="javascript:;" id="share-fab" class="post-share-fab waves-effect waves-circle">\u000a        <i class="icon icon-share-alt icon-lg"></i>\u000a    </a>\u000a</div>\u000a\u000a\u000a        </div>\u000a    </div>   \u000a\u000a    \u000a<nav class="post-nav flex-row flex-justify-between">\u000a  \u000a    <div class="waves-block waves-effect prev">\u000a      <a href="/archives/shi-yong-celeryzhi-shen-ru-celerypei-zhi/" id="post-prev" class="post-nav-link">\u000a        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>\u000a        <h4 class="title">\u4f7f\u7528celery\u4e4b\u6df1\u5165celery\u914d\u7f6e</h4>\u000a      </a>\u000a    </div>\u000a  \u000a\u000a  \u000a    <div class="waves-block waves-effect next">\u000a      <a href="/archives/shi-yong-tornadorang-ni-de-qing-qiu-yi-bu-fei-zu-sai/" id="post-next" class="post-nav-link">\u000a        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>\u000a        <h4 class="title">\u4f7f\u7528tornado\u8ba9\u4f60\u7684\u8bf7\u6c42\u5f02\u6b65\u975e\u963b\u585e</h4>\u000a      </a>\u000a    </div>\u000a  \u000a</nav>\u000a\u000a\u000a            \u000a    \u000a\u000a\u000a<section id="comments">\u000a  <div id="disqus_thread"></div>\u000a    <script type="text/javascript">\u000a    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */\u000a    var disqus_shortname = 'dongwm'; // required: replace example with your forum shortname\u000a\u000a    /* * * DON'T EDIT BELOW THIS LINE * * */\u000a    (function() {\u000a      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;\u000a      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';\u000a      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);\u000a    })();\u000a  </script>\u000a  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>\u000a</section>\u000a\u000a\u000a</article>\u000a\u000a\u000a</div>\u000a  </main>\u000a  <div class="mask" id="mask"></div>\u000a<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>\u000a\u000a<script>var BLOG = { ROOT: '/' };\u000aBLOG.SHARE = {\u000atitle: "\u5c01\u88c5pymongo\u81ea\u52a8\u5173\u95ed\u8fde\u63a5",\u000apic: "/img/avatar.png",\u000asummary: document.getElementsByName('summary')[0].content,\u000aurl: "http://www.dongwm.com/archives/feng-zhuang-pymongozi-dong-guan-bi-lian-jie/" }\u000a</script>\u000a<div class="global-share" id="global-share">\u000a    <div class="tit">\u5206\u4eab\u5230\uff1a</div>\u000a    <ul class="reset share-icons">\u000a      <li>\u000a        <a class="weibo share-sns" href="javascript:;" data-title="\u5fae\u535a" data-service="tsina">\u000a          <i class="icon icon-weibo"></i>\u000a        </a>\u000a      </li>\u000a      <li>\u000a        <a class="weixin share-sns" href="javascript:;" data-title="\u5fae\u4fe1" data-service="weixin">\u000a          <i class="icon icon-weixin"></i>\u000a        </a>\u000a      </li>\u000a      <li>\u000a        <a class="qq share-sns" href="javascript:;" data-title=" QQ" data-service="cqq">\u000a          <i class="icon icon-qq"></i>\u000a        </a>\u000a      </li>\u000a      <li>\u000a        <a class="facebook share-sns" href="javascript:;" data-title=" Facebook" data-service="fb">\u000a          <i class="icon icon-facebook"></i>\u000a        </a>\u000a      </li>\u000a      <li>\u000a        <a class="twitter share-sns" href="javascript:;" data-title=" Twitter" data-service="twitter">\u000a          <i class="icon icon-twitter"></i>\u000a        </a>\u000a      </li>\u000a      <li>\u000a        <a class="douban share-sns" href="javascript:;" data-title="\u8c46\u74e3" data-service="douban">\u000a          \u8c46\u000a        </a>\u000a      </li>\u000a    </ul>\u000a </div>\u000a\u000a\u000a  <script src="/js/jquery.min.js"></script>\u000a<script src="/js/materialize.min.js"></script>\u000a<script src="/js/waves.min.js"></script>\u000a<script src="/js/main.min.js?v=1.1.10"></script>\u000a\u000a\u000a\u000a<div class="search-panel" id="search-panel">\u000a    <ul class="search-result" id="search-result"></ul>\u000a</div>\u000a<template id="search-tpl">\u000a<li class="item">\u000a    <a href="{path}" class="waves-block waves-effect">\u000a        <div class="title ellipsis" title="{title}">{title}</div>\u000a        <div class="flex-row flex-middle">\u000a            <div class="tags ellipsis">\u000a                {tags}\u000a            </div>\u000a            <time class="flex-col time">{date}</time>\u000a        </div>\u000a    </a>\u000a</li>\u000a</template>\u000a\u000a<script src="/js/search.min.js?v=1.1.10"></script>\u000a\u000a\u000a\u000a\u000a\u000a\u000a\u000a<!-- Google Analytics -->\u000a<script type="text/javascript">\u000a(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\u000a(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\u000am=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\u000a})(window,document,'script','//www.google-analytics.com/analytics.js','ga');\u000a\u000aga('create', 'UA-20495125-2', 'auto');\u000aga('send', 'pageview');\u000a\u000a</script>\u000a<!-- End Google Analytics -->\u000a\u000a\u000a\u000a</body>\u000a</html>\u000a
p3
a.